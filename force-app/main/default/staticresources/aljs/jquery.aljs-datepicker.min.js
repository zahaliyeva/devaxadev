if("undefined"==typeof jQuery.aljs)throw new Error("Please include the ALJS initializer file");if("undefined"==typeof moment)throw new Error("The ALJS datepicker plugin requires moment.js");!function(e){var t='<div class="slds-datepicker slds-dropdown slds-dropdown--left" aria-hidden="false"><div class="slds-datepicker__filter slds-grid"><div class="slds-datepicker__filter--month slds-grid slds-grid--align-spread slds-grow"><div class="slds-align-middle"><button id="aljs-prevButton" class="slds-button slds-button--icon-container"><svg aria-hidden="true" class="slds-button__icon slds-button__icon--small"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#left"></use></svg><span class="slds-assistive-text">Previous Month</span></button></div><h2 id="aljs-month" class="slds-align-middle" aria-live="assertive" aria-atomic="true"></h2><div class="slds-align-middle"><button id="aljs-nextButton" class="slds-button slds-button--icon-container" title="Next Month"><svg aria-hidden="true" class="slds-button__icon"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#right"></use></svg><span class="slds-assistive-text">Next Month</span></button></div></div><div class="slds-shrink-none"><div class="slds-select_container"></div></div></div>',s='<table class="datepicker__month" role="grid" aria-labelledby="month"><thead><tr id="weekdays"><th id="{{label0Full}}" scope="col"><abbr title="{{label0Full}}">{{label0Abbr}}</abbr></th><th id="{{label1Full}}" scope="col"><abbr title="{{label1Full}}">{{label1Abbr}}</abbr></th><th id="{{label2Full}}" scope="col"><abbr title="{{label2Full}}">{{label2Abbr}}</abbr></th><th id="{{label3Full}}" scope="col"><abbr title="{{label3Full}}">{{label3Abbr}}</abbr></th><th id="{{label4Full}}" scope="col"><abbr title="{{label4Full}}">{{label4Abbr}}</abbr></th><th id="{{label5Full}}" scope="col"><abbr title="{{label5Full}}">{{label5Abbr}}</abbr></th><th id="{{label6Full}}" scope="col"><abbr title="{{label6Full}}">{{label6Abbr}}</abbr></th></tr></thead><tbody></tbody></table></div>',a='<tr><td colspan="7" role="gridcell" data-aljs-date="{{todaysDate}}"><a href="javascript:void(0);" class="slds-show--inline-block slds-p-bottom--x-small">{{todayLabel}}</a></td></tr>',l=function(a,l){this.$el=e(a),this.settings=l;for(var i=moment(l.initDate)||moment(),n=l.endDateInputId,d=s,r=0;r<this.settings.dayLabels.length;r++){var o=this.settings.dayLabels[r],c=new RegExp("{{label"+r+"Full}}","g"),u=new RegExp("{{label"+r+"Abbr}}","g");d=d.replace(c,o.full.toString()).replace(u,o.abbr.toString())}this.$datepickerEl=e(t.replace(/{{assetsLocation}}/g,l.assetsLocation)+d),l.initDate&&this.setSelectedFullDate(i),n&&1===e("#"+n).length&&(this.$elEndDate=e("#"+n),l.endDate&&this.setSelectedEndDate(l.endDate)),this.initInteractivity()};l.prototype={constructor:l,initInteractivity:function(){var t=this,s=this.$datepickerEl,a=this.$el,l=this.$elEndDate||[],i=function(i){if(i.stopPropagation(),e("[data-aljs-datepicker-id]").each(function(){e(this).data("datepicker").closeDatepicker()}),i.target===a[0]&&null!==a.val()&&""!==a.val()||i.target===l[0]&&null!==l.val()&&""!==l.val())t.$selectedInput=e(this).parent().find("input"),t.$selectedInput.on("keyup",t,t.processKeyup),t.closeDatepicker();else{var n=t.selectedFullDate||moment();t.viewedMonth=n.month(),t.viewedYear=n.year(),t.fillMonth(),t.$selectedInput=e(this).parent().find("input"),t.$selectedInput.off("keyup"),t.$selectedInput.closest(".slds-form-element").append(s),t.settings.onShow(t),t.initYearDropdown(),e([a,s,l,a.prev("svg")]).each(function(){e(this).on("click",t.blockClose)}),s.on("click",t,t.processClick),e("body").on("click",t,t.closeDatepicker)}};a.on("blur",t,t.processBlur),a.on("click",i),e(a.prev("svg")).on("click",i),a.prev("svg").css("cursor","pointer"),l.length>0&&(l.on("blur",t,t.processBlur),l.on("focus",i),l.prev("svg").on("click",i),l.prev("svg").css("cursor","pointer"))},closeDatepicker:function(t){var s=this,a=e("body");t&&(s=t.data,a=e(this));var l=s.$datepickerEl,i=s.$selectedInput;if(0===a.closest(s.$el.parent()).length&&i){var n=i.closest(".slds-form-element").find(".slds-datepicker");n.length>0&&(s.settings.onDismiss(s),i.closest(".slds-form-element").find(".slds-datepicker").remove()),e("body").unbind("click",s.closeDatepicker),l.unbind("click",s.processClick)}},fillMonth:function(){var t=this.settings.dayLabels,s=this.getMonthArray(),l=e("<tbody>"),i=this.$elEndDate&&this.$elEndDate.length>0;this.selectedFullDate,this.selectedEndDate;s.forEach(function(s){var a=e("<tr>").appendTo(l);s.hasMultiRowSelection&&a.addClass("slds-has-multi-row-selection"),s.data.forEach(function(s,l){var n=e('<td data-aljs-date="'+s.dateValue+'">').appendTo(a);n.prop({headers:t[l].full,role:"gridcell"}),e('<span class="slds-day">'+s.value+"</span>").appendTo(n),s.isCurrentMonth||n.addClass("slds-disabled-text").attr("aria-disabled","true"),s.isSelected||s.isSelectedEndDate||s.isSelectedMulti?n.addClass(i?"slds-is-selected-multi slds-is-selected":"slds-is-selected").attr("aria-selected","true"):n.attr("aria-selected","false"),s.isToday&&n.addClass("slds-is-today")})}),l.append(a.replace(/{{todaysDate}}/g,this.getMMDDYYYY(moment().month()+1,moment().date(),moment().year())).replace(/{{todayLabel}}/g,this.settings.todayLabel.toString())),this.$datepickerEl.find("tbody").replaceWith(l),this.$datepickerEl.find("#aljs-month").text(this.settings.monthLabels[this.viewedMonth].full),this.$datepickerEl.find("#aljs-year").text(this.viewedYear)},initYearDropdown:function(){var t=this,s=this.$datepickerEl.find("select"),a=this.viewedYear;if(s.length>0)s.val(this.viewedYear);else{var l=e("<label></label>");s=e('<select class="slds-select select picklist__label">').appendTo(l);for(var i=moment().year(),n=i-this.settings.numYearsBefore;n<=i+this.settings.numYearsAfter;n++){e('<option value="'+n+'">'+n+"</option>").appendTo(s)}s.val(a),this.$datepickerEl.find(".slds-select_container").append(l)}s.on("change",function(s){t.viewedYear=parseInt(e(s.target).val()),t.fillMonth()})},getMMDDYYYY:function(e,t,s){return(e>9?e:"0"+e)+"/"+(t>9?t:"0"+t)+"/"+s},getMonthArray:function(){for(var e=this.selectedFullDate,t=this.selectedEndDate,s=(e?e.date():null,e?e.month():null,e?e.year():null,this.viewedMonth),a=this.viewedYear,l=0===s?11:s-1,i=11===s?0:s+1,n=this.getNumDaysInMonth(a,s),d=this.getNumDaysInMonth(a,l),r=(this.getNumDaysInMonth(a,i),new Date(a,s,1).getDay()),o=[],c=[],u=(this.dayLabels,d-(r-1));u<=d;u++){var h=moment(new Date(11===l?a-1:a,l,u));o.push({value:u,dateValue:this.getMMDDYYYY(l+1,u,a),isCurrentMonth:!1,isToday:h.isSame(moment(),"day")})}for(var u=1;u<=n;u++){var h=moment(new Date(a,s,u));o.push({value:u,dateValue:this.getMMDDYYYY(s+1,u,a),isCurrentMonth:!0,isSelected:e&&h.isSame(e,"day"),isSelectedEndDate:t&&h.isSame(t,"day"),isSelectedMulti:e&&t&&(h.isBetween(e,t)||h.isSame(e,"day")||h.isSame(t,"day")),isToday:h.isSame(moment(),"day")})}if(o.forEach(function(e,t,s){if(t%7===0){var a=t>=7&&s[t-1].isSelectedMulti&&e.isSelectedMulti;a&&(c[c.length-1].hasMultiRowSelection=!0),c.push({data:[],hasMultiRowSelection:a})}c[c.length-1].data.push(e)}),c[c.length-1].data.length<7)for(var h=moment(new Date(0===i?a+1:a,i,u)),p=7-c[c.length-1].data.length,u=1;u<=p;u++)c[c.length-1].data.push({value:u,dateValue:this.getMMDDYYYY(i+1,u,0===i?a+1:a),isCurrentMonth:!1,isSelected:e&&h.isSame(e,"day"),isToday:h.isSame(moment(),"day")});return c},setSelectedFullDate:function(e){var t=this.selectedFullDate;this.selectedFullDate=e,""!==e&&null!==e&&"undefined"!=typeof e?(this.$el.val(e.format(this.settings.format)),navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1&&this.$el.val(e.format(this.settings.format))):this.$el.val(""),(!t&&""!=e||"object"==typeof t&&!t.isSame(e,"day"))&&this.settings.onChange(this)},setSelectedEndDate:function(e){var t=this.selectedEndDate;this.selectedEndDate=e,""!==e&&null!==e&&"undefined"!=typeof e?(this.$elEndDate.val(e.format(this.settings.format)),navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1&&this.$elEndDate.val(e.format(this.settings.format))):this.$elEndDate.val(""),(!t&&""!=e||"object"==typeof t&&!t.isSame(e,"day"))&&this.settings.onChange(this)},processClick:function(t){t.preventDefault();var s=t.data,a=e(t.target);a.closest("#aljs-prevButton").length>0&&s.clickPrev(t),a.closest("#aljs-nextButton").length>0&&s.clickNext(t),a.closest("td[data-aljs-date]").length>0&&s.clickDate(t),a.closest("li[data-aljs-year]").length>0&&s.clickYear(t)},processKeyup:function(t){13===t.keyCode&&e(this).blur().off("keyup")},processBlur:function(e){if(e){var t=e.data;if(t.$elEndDate&&t.$elEndDate.length>0&&t.$elEndDate[0]===t.$selectedInput[0]){var s=t.$elEndDate.val(),a=moment(s,t.settings.format);a.isValid()?(t.setSelectedEndDate(a),t.closeDatepicker(e),t.$selectedInput.off("keyup")):s.length||t.setSelectedEndDate("")}else{var l=t.$el.val(),i=moment(l,t.settings.format);i.isValid()?(t.setSelectedFullDate(i),t.closeDatepicker(e),t.$selectedInput.off("keyup")):l.length||t.setSelectedFullDate("")}}},clickPrev:function(e){var t=e.data,s=moment().year();0===t.viewedMonth?(t.viewedMonth=11,t.viewedYear===s-t.settings.numYearsBefore?(t.viewedYear=s+t.settings.numYearsAfter,t.$datepickerEl.find(".slds-select option:selected").prop("selected",!1),t.$datepickerEl.find(".slds-select option").last().prop("selected","selected")):(t.viewedYear--,t.$datepickerEl.find(".slds-select option:selected").prop("selected",!1).prev().prop("selected","selected"))):t.viewedMonth--,t.fillMonth()},clickNext:function(e){var t=e.data,s=moment().year();11===t.viewedMonth?(t.viewedMonth=0,t.viewedYear===s+t.settings.numYearsAfter?(t.viewedYear=s-t.settings.numYearsBefore,t.$datepickerEl.find(".slds-select option:selected").prop("selected",!1),t.$datepickerEl.find(".slds-select option").first().prop("selected","selected")):(t.viewedYear++,t.$datepickerEl.find(".slds-select option:selected").prop("selected",!1).next().prop("selected","selected"))):t.viewedMonth++,t.fillMonth()},clickYear:function(t){var s=t.data,a=e(t.target).closest("li[data-aljs-year]");s.viewedYear=parseInt(a.data("aljs-year")),s.fillMonth()},clickYearDropdown:function(e){var t=e.data;t.$datepickerEl.find("#aljs-yearDropdown").length>0?t.hideYearDropdown():t.showYearDropdown()},clickDate:function(t){var s=t.data,a=e(t.target).closest("td[data-aljs-date]");if(!a.hasClass("slds-disabled-text")){var l=a.data("aljs-date");s.$elEndDate&&s.$elEndDate.length>0&&s.$elEndDate[0]===s.$selectedInput[0]?s.setSelectedEndDate(moment(l,"MM/DD/YYYY")):s.setSelectedFullDate(moment(l,"MM/DD/YYYY")),s.settings.onSelect(s,moment(l,"MM/DD/YYYY")),s.closeDatepicker(t)}},blockClose:function(e){e.stopPropagation()},isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getNumDaysInMonth:function(e,t){return[31,this.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},getDate:function(e){return e?this.selectedFullDate.format(e):this.selectedFullDate},setDate:function(e){this.setSelectedFullDate(moment(e))},getEndDate:function(e){if(this.$elEndDate&&this.selectedEndDate)return e?this.selectedEndDate.format(e):this.selectedEndDate},setEndDate:function(e){this.$elEndDate&&this.setSelectedEndDate(moment(e))}},e.fn.datepicker=function(t,s){var a,i=e.extend({assetsLocation:e.aljs.assetsLocation,numYearsBefore:50,numYearsAfter:10,format:"MM/DD/YYYY",endDateInputId:null,onChange:function(e){},onShow:function(e){},onDismiss:function(e){},onSelect:function(e,t){},dayLabels:[{full:"Sunday",abbr:"Sun"},{full:"Monday",abbr:"Mon"},{full:"Tuesday",abbr:"Tue"},{full:"Wednesday",abbr:"Wed"},{full:"Thursday",abbr:"Thu"},{full:"Friday",abbr:"Fri"},{full:"Saturday",abbr:"Sat"}],monthLabels:[{full:"January",abbr:""},{full:"February",abbr:""},{full:"March",abbr:""},{full:"April",abbr:""},{full:"May",abbr:""},{full:"June",abbr:""},{full:"July",abbr:""},{full:"August",abbr:""},{full:"September",abbr:""},{full:"October",abbr:""},{full:"November",abbr:""},{full:"December",abbr:""}],todayLabel:"Today"},"object"==typeof t?t:{});if(this.each(function(){var n=e(this),d=n.data("datepicker");if(!d){var r=new l(this,i);n.data("datepicker",d=r),n.attr("data-aljs-datepicker-id",n.attr("id"))}"string"==typeof t&&(a=d[t](s))}),void 0===a||a instanceof l)return this;if(this.length>1)throw new Error("Usage only allowed for the collection of a single element ("+option+" function)");return a}}(jQuery);